#!/usr/bin/env bash

# Hanif CLI - Personal productivity tool
# Version: 1.0.0

set -euo pipefail

# Resolve symlink to find the actual script location
if [[ -L "$0" ]]; then
  SCRIPT_DIR="$(cd "$(dirname "$(readlink "$0")")" && pwd)"
else
  SCRIPT_DIR="$(cd "$(dirname "$0")" && pwd)"
fi

# Set up library path
LIB_DIR="${SCRIPT_DIR}/../lib"
COMMANDS_DIR="${LIB_DIR}/commands"
UTILS_DIR="${LIB_DIR}/utils"
FUNCTIONS_DIR="${LIB_DIR}/functions"

# Source common utilities
# shellcheck source=../lib/utils/common.sh
source "${UTILS_DIR}/common.sh"

# CLI Version
VERSION="1.0.0"

# Main command dispatcher
main() {
  # Handle no arguments
  if [[ $# -eq 0 ]]; then
    show_usage
    exit 0
  fi

  local command="$1"
  shift

  case "$command" in
    git)
      # shellcheck source=../lib/commands/git.sh
      source "${COMMANDS_DIR}/git.sh"
      git_command "$@"
      ;;
    
    squash)
      # shellcheck source=../lib/commands/squash.sh
      source "${COMMANDS_DIR}/squash.sh"
      squash_command "$@"
      ;;
    
    help|--help|-h)
      # shellcheck source=../lib/commands/help.sh
      source "${COMMANDS_DIR}/help.sh"
      show_help "$@"
      ;;
    
    version|--version|-v)
      echo "hanif CLI v${VERSION}"
      ;;
    
    *)
      echo "❌ Unknown command: $command"
      echo ""
      show_usage
      exit 1
      ;;
  esac
}

# Show basic usage
show_usage() {
  cat << 'EOF'
┌─────────────────────────────────────────────┐
│              Hanif CLI v1.0.0               │
└─────────────────────────────────────────────┘

Simple, extensible CLI for daily workflows

Usage: hanif <command> [options]

Commands:
  git <subcommand>    Git helpers (sync, nf, up, etc.)
  squash <count>      Interactive commit squashing
  help [command]      Show help
  version             Show version

Examples:
  hanif git sync
  hanif git nf "add feature"
  hanif squash 5
  hanif help git

Add your own commands - see README.md
EOF
}

# Run main function
main "$@"
